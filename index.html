<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„ë‹¨ íŒ€ ì¶”ì²¨ ë° ì¹´ë“œ ë½‘ê¸°(ëª¨ë°”ì¼ ìµœì í™”)</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ ë° í°íŠ¸ ì„¤ì • */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .card {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            user-select: none;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
        }
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* ëª¨ë°”ì¼ì—ì„œ ì œëª© í¬ê¸° ì¡°ì • */
        @media (max-width: 640px) {
            h1.responsive-title {
                font-size: 2rem; /* ëª¨ë°”ì¼ì—ì„œ ì œëª© í¬ê¸° ì¤„ì„ */
            }
        }
    </style>
    <script>
        // í¬ì§€ì…˜ ê¸°ë³¸ ì„¤ì • (4-4-2 í¬ë©”ì´ì…˜ + ê½ 1ì¥)
        const DEFAULT_POSITIONS = {
            GK: 1, // ê³¨í‚¤í¼
            DEF: 4, // ìˆ˜ë¹„ìˆ˜
            MID: 4, // ë¯¸ë“œí•„ë”
            FWD: 2, // ê³µê²©ìˆ˜
            DUD: 1, // ê½ (Miss) í•­ëª© ì¶”ê°€
        };

        let positionSettings = { ...DEFAULT_POSITIONS };
        let draftPool = []; // Available assignments (Team/Position)
        let currentTeamRosters = []; // Publicly revealed assignments ({name, team, position})
        let nextPlayerIndex = 1;
        
        let currentOptions = []; // The 1, 2, or 3 cards currently drawn for selection
        let drawCount = 0; // Number of cards the current player draws
        let activeNumTeams = 0; // í˜„ì¬ í™œì„±í™”ëœ íŒ€ ìˆ˜ (1íŒ€ ë˜ëŠ” 2íŒ€)

        // --------------------------------------------------
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // --------------------------------------------------

        // ë°°ì—´ ì…”í”Œ (Fisher-Yates ì•Œê³ ë¦¬ì¦˜)
        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        };

        // ì»¤ìŠ¤í…€ ëª¨ë‹¬ í•¨ìˆ˜ (ì„ íƒ ê²°ê³¼ í™•ì¸ìš©)
        const alertModal = (message) => {
            const modal = document.getElementById('custom-modal');
            // HTML íƒœê·¸ê°€ í¬í•¨ëœ ë©”ì‹œì§€ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ innerHTML ì‚¬ìš©
            document.getElementById('modal-message').innerHTML = message; 
            modal.classList.remove('hidden');
        };
        
        window.closeModal = () => {
             document.getElementById('custom-modal').classList.add('hidden');
             // ëª¨ë‹¬ ë‹«ì€ í›„ ë°”ë¡œ ë‹¤ìŒ ë“œë¡œìš° ì‹œì‘ ë²„íŠ¼ì„ ë Œë”ë§
             renderControlPanel();
        }

        // í•œêµ­ì–´ í¬ì§€ì…˜ ì´ë¦„ ë°˜í™˜
        const getKoreanPositionName = (pos) => {
            switch(pos) {
                case 'GK': return 'ê³¨í‚¤í¼';
                case 'DEF': return 'ìˆ˜ë¹„ìˆ˜';
                case 'MID': return 'ë¯¸ë“œí•„ë”';
                case 'FWD': return 'ê³µê²©ìˆ˜';
                case 'DUD': return 'ê½'; // 'ê½' ì¶”ê°€
                default: return 'ê¸°íƒ€';
            }
        };

        /**
         * ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ ë½‘ì„ ì¹´ë“œ ìˆ˜ë¥¼ ê²°ì •í•˜ëŠ” ë¡œì§ (ì‚¬ìš©ìì˜ ìƒˆë¡œìš´ ê·œì¹™ ì ìš©)
         * * ê·œì¹™:
         * - 2íŒ€ ì´ìƒ: P1, P2 (3ì¥) / P3 ~ P8 (2ì¥) / ë‚˜ë¨¸ì§€ (1ì¥)
         * - 1íŒ€: P1 (3ì¥) / P2 ~ P4 (2ì¥) / ë‚˜ë¨¸ì§€ (1ì¥)
         */
        const getDrawCount = (numPlayersDrawn, totalPlayers) => {
            let group3Size = 0; // 3ì¥ ë½‘ëŠ” ì¸ì› ìˆ˜
            let group2Size = 0; // 2ì¥ ë½‘ëŠ” ì¸ì› ìˆ˜
            
            if (activeNumTeams >= 2) {
                // 2íŒ€ ì´ìƒ ê·œì¹™ ì ìš© (P1, P2 = 3ì¥; P3~P8 = 2ì¥)
                group3Size = 2; // P1, P2
                group2Size = 6; // P3 ~ P8 (ì´ 6ëª…)
            } else if (activeNumTeams === 1) {
                // 1íŒ€ ê·œì¹™ ì ìš© (P1 = 3ì¥; P2~P4 = 2ì¥)
                group3Size = 1; // P1
                group2Size = 3; // P2 ~ P4 (ì´ 3ëª…)
            }
            
            // 1. 3-Card Group (P1, or P1, P2)
            if (numPlayersDrawn < group3Size) {
                return 3;
            }
            
            // 2. 2-Card Group (ë‹¤ìŒ 3ëª… ë˜ëŠ” 6ëª…)
            const twoCardStartIdx = group3Size;
            const twoCardEndIdx = twoCardStartIdx + group2Size; 

            if (numPlayersDrawn >= twoCardStartIdx && numPlayersDrawn < twoCardEndIdx) {
                return 2;
            }

            // 3. 1-Card Group (Remaining players)
            return 1;
        };


        // --------------------------------------------------
        // UI ìƒì„± ë° ì„¤ì • ë¡œì§
        // --------------------------------------------------

        // í¬ì§€ì…˜ ì„¤ì • UI ìƒì„±
        const initializePositionSettings = () => {
            const container = document.getElementById('position-settings-container');
            container.innerHTML = '';
            
            // í¬ì§€ì…˜ ìˆœì„œ: GK, DEF, MID, FWD, DUD (ê½)
            const orderedKeys = ['GK', 'DEF', 'MID', 'FWD', 'DUD']; 

            orderedKeys.forEach(pos => {
                const settingDiv = document.createElement('div');
                settingDiv.className = 'flex items-center justify-between p-2 bg-gray-50 rounded-lg';
                
                // 'ê½' í•­ëª©ì€ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë¥´ê²Œ í‘œì‹œ
                const labelText = pos === 'DUD' ? 'ê½' : `${pos} (${getKoreanPositionName(pos)})`;

                settingDiv.innerHTML = `
                    <label for="pos-${pos}" class="text-sm font-medium text-gray-700 w-1/2">${labelText}</label>
                    <input type="number" id="pos-${pos}" value="${positionSettings[pos] || 0}" min="0" class="w-1/3 p-2 border border-gray-300 rounded-lg text-center text-gray-800" onchange="updatePositionCount('${pos}', this.value)">
                `;
                container.appendChild(settingDiv);
            });
            updateTotalPlayersNeeded();
        };

        // í¬ì§€ì…˜ ìˆ˜ ì—…ë°ì´íŠ¸
        window.updatePositionCount = (pos, value) => {
            const count = parseInt(value);
            if (!isNaN(count) && count >= 0) {
                positionSettings[pos] = count;
                updateTotalPlayersNeeded();
            }
        };

        // í•„ìš”í•œ ì´ ì„ ìˆ˜ ìˆ˜ ì—…ë°ì´íŠ¸
        const updateTotalPlayersNeeded = () => {
            const total = Object.values(positionSettings).reduce((sum, count) => sum + count, 0);
            document.getElementById('total-players-needed').textContent = total;
            updateButtonTotals();
        };
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ì˜ ì´ ì¸ì›ìˆ˜ ì—…ë°ì´íŠ¸
        const updateButtonTotals = () => {
             const total = Object.values(positionSettings).reduce((sum, count) => sum + count, 0);
             document.getElementById('total-players-needed-1').textContent = total;
             document.getElementById('total-players-needed-2').textContent = total * 2;
        };
        

        // --------------------------------------------------
        // íŒ€ ì¶”ì²¨ ë° ì¹´ë“œ ìƒì„± ë¡œì§
        // --------------------------------------------------

        const startDraft = (numTeams) => {
            // ì´ˆê¸°í™”
            draftPool = [];
            currentTeamRosters = [];
            nextPlayerIndex = 1;
            currentOptions = []; 
            activeNumTeams = numTeams; // í™œì„±í™”ëœ íŒ€ ìˆ˜ ì €ì¥
            
            const totalPlayersPerTeam = Object.values(positionSettings).reduce((sum, count) => sum + count, 0);
            const requiredTotalPlayers = totalPlayersPerTeam * numTeams;

            if (totalPlayersPerTeam === 0) {
                alertModal("í¬ì§€ì…˜ë³„ ì¸ì›ìˆ˜ë¥¼ 1ëª… ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            // 1. ì „ì²´ í¬ì§€ì…˜ ìŠ¬ë¡¯ ìƒì„±
            let posAssignments = [];
            for (let i = 1; i <= numTeams; i++) {
                const teamName = `íŒ€ ${i}`;
                for (const [pos, count] of Object.entries(positionSettings)) {
                    for (let j = 0; j < count; j++) {
                        // ëª¨ë“  í¬ì§€ì…˜(DUD í¬í•¨)ì„ ê° íŒ€ì— í• ë‹¹í•˜ì—¬ í’€ì„ ìƒì„±
                        posAssignments.push({ team: teamName, position: pos }); 
                    }
                }
            }

            // 2. ì „ì²´ í• ë‹¹ ëª©ë¡ì„ ì„ì–´ì„œ ë“œë˜í”„íŠ¸ í’€ì— ì €ì¥
            draftPool = shuffleArray(posAssignments);

            // 3. UI ì—…ë°ì´íŠ¸
            renderRosters();
            renderControlPanel(); // ë‹¤ìŒ ë“œë¡œìš° ì‹œì‘ ë²„íŠ¼ ë Œë”ë§
        };
        
        window.startDraftOneTeam = () => startDraft(1);
        window.startDraftTwoTeams = () => startDraft(2);
        
        
        // --------------------------------------------------
        // ì¹´ë“œ ì„ íƒ ì˜µì…˜ ë“œë¡œìš°
        // --------------------------------------------------
        
        window.startPlayerDraw = () => {
            if (draftPool.length === 0) {
                document.getElementById('draw-status-message').textContent = `ëª¨ë“  ${currentTeamRosters.length}ëª…ì˜ ì¶”ì²¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`;
                renderControlPanel(); 
                return;
            }

            const totalPlayers = currentTeamRosters.length + draftPool.length;
            const playersDrawn = currentTeamRosters.length; // 0ë¶€í„° ì‹œì‘

            // 1. Draw Count ê²°ì •
            drawCount = getDrawCount(playersDrawn, totalPlayers);
            if (draftPool.length < drawCount) {
                drawCount = draftPool.length; // ë‚¨ì€ ì¹´ë“œ ìˆ˜ê°€ ì ì„ ê²½ìš° ì¡°ì •
            }

            // 2. draftPoolì—ì„œ ì¹´ë“œ ë“œë¡œìš°í•˜ì—¬ currentOptionsì— ì €ì¥
            currentOptions = [];
            for (let i = 0; i < drawCount; i++) {
                // ë§¨ ì•ì˜ ì¹´ë“œë¥¼ ë½‘ì•„ì˜´ (draftPoolì€ ì´ë¯¸ ì…”í”Œë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë¬´ì‘ìœ„ íš¨ê³¼)
                const drawnCard = draftPool.splice(0, 1)[0]; 
                currentOptions.push(drawnCard);
            }

            // 3. (ì¶”ê°€ ë¡œì§) Draw Countê°€ 1ì¸ ê²½ìš°, ìë™ í™•ì • ì²˜ë¦¬
            if (drawCount === 1) {
                // 0ë²ˆ ì¸ë±ìŠ¤ ì¹´ë“œë¥¼ ìë™ ì„ íƒí•˜ê³ , renderRostersì™€ alertModalì´ selectAssignment ë‚´ì—ì„œ í˜¸ì¶œë¨.
                window.selectAssignment(0); 
                
                // ëª¨ë‹¬ì´ ëœ¬ í›„, closeModalì—ì„œ renderControlPanel()ì„ í˜¸ì¶œí•˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ë³„ë„ì˜ ë Œë”ë§/ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ëŠ” ìƒëµí•˜ê³  return
                return;
            }

            // 4. (ê¸°ì¡´ ë¡œì§ - 2ì¥ ë˜ëŠ” 3ì¥ì¼ ê²½ìš°) ì„ íƒ ì¹´ë“œ ë Œë”ë§
            renderCardOptions();
            
            document.getElementById('draw-status-message').innerHTML = `
                <span class="text-blue-600 font-bold">í”Œë ˆì´ì–´ ${nextPlayerIndex}</span>ë‹˜ ì°¨ë¡€ì…ë‹ˆë‹¤. ${drawCount}ì¥ì˜ ì¹´ë“œ ì¤‘ <span class="text-red-600 font-extrabold">í•˜ë‚˜</span>ë¥¼ ì„ íƒí•˜ì„¸ìš”!
            `;
        };
        
        // --------------------------------------------------
        // ì„ íƒëœ ì¹´ë“œ ì²˜ë¦¬ (ì„ íƒ ì™„ë£Œ)
        // --------------------------------------------------

        window.selectAssignment = (selectedIndexStr) => {
            const selectedIndex = parseInt(selectedIndexStr);
            
            if (isNaN(selectedIndex) || selectedIndex < 0 || selectedIndex >= currentOptions.length) return;
            
            const chosenAssignment = currentOptions[selectedIndex];
            
            // 1. ì„ íƒëœ í• ë‹¹ì„ ë¡œìŠ¤í„°ì— ì¶”ê°€
            const revealedAssignment = {
                name: `í”Œë ˆì´ì–´ ${nextPlayerIndex++}`,
                team: chosenAssignment.team,
                position: chosenAssignment.position
            };
            currentTeamRosters.push(revealedAssignment);
            
            // 2. ì„ íƒë˜ì§€ ì•Šì€ ì¹´ë“œë“¤ì€ draftPoolì— ë°˜í™˜
            currentOptions.forEach((option, index) => {
                if (index !== selectedIndex) {
                    draftPool.push(option); // í’€ì— ë°˜í™˜
                }
            });
            
            // 3. ì˜µì…˜ í´ë¦¬ì–´ ë° í’€ ì…”í”Œ
            currentOptions = [];
            draftPool = shuffleArray(draftPool); // ë°˜í™˜ëœ ì¹´ë“œë¥¼ ì„ì–´ ë¬´ì‘ìœ„ì„±ì„ ìœ ì§€
            
            // 4. UI ì—…ë°ì´íŠ¸
            renderRosters();
            
            // ì„ íƒ ê²°ê³¼ ëª¨ë‹¬ë¡œ í”¼ë“œë°±
            let modalMessage;

            if (chosenAssignment.position === 'DUD') {
                 // 'ê½' ì¹´ë“œ ì„ íƒ ì‹œ íŠ¹ë³„ ë©”ì‹œì§€
                 modalMessage = `${revealedAssignment.name}ë‹˜ì´ <span class="font-extrabold text-red-700">ğŸ’¥ ê½</span>ì„ ë½‘ì•˜ìŠµë‹ˆë‹¤! (ë‚¨ì€ ì¹´ë“œ: ${draftPool.length}ì¥) ì´ì œ ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ ì¶”ì²¨í•©ë‹ˆë‹¤.`;
            } else {
                 modalMessage = `${revealedAssignment.name}ë‹˜ì´ '${revealedAssignment.team}'ì˜ '${getKoreanPositionName(revealedAssignment.position)}' í¬ì§€ì…˜ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤! (ë‚¨ì€ ì¹´ë“œ: ${draftPool.length}ì¥)`;
            }
            
            if (drawCount === 1) {
                // 1ì¥ í™•ì •ì¼ ë•Œì˜ ë©”ì‹œì§€
                if (chosenAssignment.position === 'DUD') {
                     modalMessage = `${revealedAssignment.name}ë‹˜ì—ê²Œ <span class="font-extrabold text-red-700">ğŸ’¥ ê½</span>ì´ <span class="font-extrabold text-red-600">ìë™ìœ¼ë¡œ í™•ì •</span>ë˜ì—ˆìŠµë‹ˆë‹¤! (ë‚¨ì€ ì¹´ë“œ: ${draftPool.length}ì¥)`;
                } else {
                     modalMessage = `${revealedAssignment.name}ë‹˜ì—ê²Œ '${revealedAssignment.team}'ì˜ '${getKoreanPositionName(revealedAssignment.position)}' í¬ì§€ì…˜ì´ <span class="font-extrabold text-red-600">ìë™ìœ¼ë¡œ í™•ì •</span>ë˜ì—ˆìŠµë‹ˆë‹¤! (ë‚¨ì€ ì¹´ë“œ: ${draftPool.length}ì¥)`;
                }
            }

            alertModal(modalMessage);
        };


        // --------------------------------------------------
        // ë Œë”ë§ í•¨ìˆ˜
        // --------------------------------------------------
        
        // ì¹´ë“œë¥¼ ë½‘ì€ í›„ ì„ íƒí•  ì˜µì…˜ë“¤ì„ ë Œë”ë§
        const renderCardOptions = () => {
            const cardPickerEl = document.getElementById('card-picker');
            cardPickerEl.innerHTML = '';
            
            // í˜„ì¬ ì„ íƒí•  ìˆ˜ ìˆëŠ” ì¹´ë“œ ì˜µì…˜ ë Œë”ë§
            currentOptions.forEach((option, index) => {
                const cardEl = document.createElement('div');
                
                const isDud = option.position === 'DUD';
                const cardBgClass = isDud ? 'bg-gray-300 text-gray-700' : 'bg-yellow-400 text-gray-800 hover:bg-yellow-500';
                
                // ëª¨ë°”ì¼ì—ì„œë„ ì¹´ë“œë¥¼ ëˆ„ë¥´ê¸° ì‰½ë„ë¡ ìµœì†Œ ë†’ì´ì™€ ë„“ì´ë¥¼ ìœ ì§€
                cardEl.className = `card ${cardBgClass} rounded-xl shadow-lg flex-col justify-between h-36 min-w-[120px]`;
                cardEl.onclick = (e) => window.selectAssignment(index);

                cardEl.innerHTML = `
                    <p class="text-sm font-semibold text-gray-700">${isDud ? 'ë²Œì¹™/ì¬ì¶”ì²¨' : 'ì„ íƒ ì¹´ë“œ'} ${index + 1}</p>
                    <div class="text-xl font-extrabold flex items-center justify-center h-full">
                        ${option.team} / ${getKoreanPositionName(option.position)} ${isDud ? 'ğŸ’¥' : ''}
                    </div>
                `;
                cardPickerEl.appendChild(cardEl);
            });
            
            // ì¹´ë“œ ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ì„¤ì • (ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´, ê³µê°„ì´ í™•ë³´ë˜ë©´ 2~3ì—´)
            let gridColsClass = '';
            if (currentOptions.length === 1) {
                gridColsClass = 'grid-cols-1';
            } else if (currentOptions.length === 2) {
                gridColsClass = 'grid-cols-1 sm:grid-cols-2';
            } else { // 3ì¥ ì´ìƒ
                gridColsClass = 'grid-cols-1 sm:grid-cols-3';
            }

            // `card-picker` ìš”ì†Œì˜ í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            cardPickerEl.className = `grid gap-4 min-h-[150px] items-start ${gridColsClass}`;
        };

        // ë©”ì¸ ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ì¶”ì²¨ ì‹œì‘ ë²„íŠ¼ ë˜ëŠ” ì™„ë£Œ ë©”ì‹œì§€) ë Œë”ë§
        const renderControlPanel = () => {
            const cardPickerEl = document.getElementById('card-picker');
            cardPickerEl.innerHTML = '';
            
            // `card-picker`ì˜ ê·¸ë¦¬ë“œ í´ë˜ìŠ¤ë¥¼ ê¸°ë³¸ ìƒíƒœë¡œ ì¬ì„¤ì •
            cardPickerEl.className = `grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4 min-h-[150px] items-start`;

            // 1. ì„ íƒ ì˜µì…˜ì´ ë Œë”ë§ ì¤‘ì´ë©´ ì—¬ê¸°ì„œ ë¹ ì ¸ë‚˜ê°
            if (currentOptions.length > 0) {
                renderCardOptions(); 
                return;
            }

            // 2. ëª¨ë“  ë“œë˜í”„íŠ¸ê°€ ì™„ë£Œëœ ê²½ìš°
            if (draftPool.length === 0 && currentTeamRosters.length > 0) {
                document.getElementById('draw-status-message').textContent = `ëª¨ë“  ${currentTeamRosters.length}ëª…ì˜ ì¶”ì²¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`;
                cardPickerEl.innerHTML = `<div class="bg-green-100 p-4 rounded-xl text-center text-green-800 font-semibold col-span-full">ëª¨ë“  ì„ ìˆ˜ í• ë‹¹ ì™„ë£Œ!</div>`;
                return;
            }
            
            // 3. ë“œë˜í”„íŠ¸ ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš° (ì´ˆê¸° ìƒíƒœ)
            if (draftPool.length === 0 && currentTeamRosters.length === 0) {
                document.getElementById('draw-status-message').textContent = `ì™¼ìª½ì—ì„œ í¬ì§€ì…˜ì„ ì„¤ì •í•˜ê³  'ì¹´ë“œ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ì²¨ì„ ì¤€ë¹„í•˜ì„¸ìš”.`;
                cardPickerEl.innerHTML = `<p class="text-lg text-gray-500 text-center py-10 col-span-full">ëŒ€ê¸° ì¤‘...</p>`;
                return;
            }
            
            // 4. ë‹¤ìŒ ë“œë¡œìš° ì¤€ë¹„ ìƒíƒœ (Start Draw ë²„íŠ¼ ë Œë”ë§)
            
            const totalPlayers = currentTeamRosters.length + draftPool.length;
            const playersDrawn = currentTeamRosters.length;
            
            // ë‚¨ì€ ì¹´ë“œê°€ drawCountë³´ë‹¤ ì ìœ¼ë©´ ì¡°ì •ëœ drawCount ì‚¬ìš©
            const nextDrawCount = Math.min(getDrawCount(playersDrawn, totalPlayers), draftPool.length);
            
            const nextPlayerName = `í”Œë ˆì´ì–´ ${currentTeamRosters.length + 1}`;
            
            document.getElementById('draw-status-message').innerHTML = `
                <span class="text-blue-600 font-bold">${nextPlayerName}</span>ë‹˜ ì°¨ë¡€ì…ë‹ˆë‹¤. (ì´ ì¸ì› ${totalPlayers}ëª… ì¤‘ ${playersDrawn + 1}ë²ˆì§¸)
            `;

            let buttonSubtext = ``;
            if (nextDrawCount === 1) {
                 // 1ì¥ í™•ì • ê·¸ë£¹
                 buttonSubtext = `<p class="mt-1 text-sm">(ì¹´ë“œê°€ ìë™ìœ¼ë¡œ í™•ì •ë©ë‹ˆë‹¤.)</p>`;
            } else {
                 // 2ì¥ ë˜ëŠ” 3ì¥ ì„ íƒ ê·¸ë£¹
                 buttonSubtext = `<p class="mt-1 text-sm">(${nextDrawCount}ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ì•„ ì„ íƒí•©ë‹ˆë‹¤.)</p>`;
            }


            cardPickerEl.innerHTML = `
                <button onclick="window.startPlayerDraw()" class="w-full bg-red-600 text-white font-semibold py-4 rounded-xl hover:bg-red-700 transition duration-300 shadow-xl col-span-full">
                    <span class="text-3xl font-extrabold">${nextPlayerName} ì¶”ì²¨ ì‹œì‘!</span>
                    ${buttonSubtext}
                </button>
            `;
        };

        const renderRosters = () => {
            const resultsContainer = document.getElementById('results-container');
            resultsContainer.innerHTML = '';
            
            const numTeams = Math.max(...currentTeamRosters.map(r => parseInt(r.team.split(' ')[1])) || [0], 0);
            const teamColors = ['bg-red-600', 'bg-blue-600']; 
            
            // íŒ€ë³„ë¡œ ë¡œìŠ¤í„° ë¶„ë¥˜
            const teams = {};
            for (let i = 1; i <= numTeams; i++) {
                teams[`íŒ€ ${i}`] = [];
            }
            
            // currentTeamRostersëŠ” ì´ë¯¸ ë½‘ì€ ìˆœì„œëŒ€ë¡œ ì €ì¥ë˜ì–´ ìˆìœ¼ë¯€ë¡œ,
            // ì´ ìˆœì„œëŒ€ë¡œ ê° íŒ€ ë¡œìŠ¤í„°ì— ì¶”ê°€í•˜ë©´ ë½‘ì€ ìˆœì„œê°€ ìœ ì§€ë©ë‹ˆë‹¤.
            currentTeamRosters.forEach(p => {
                if (teams[p.team]) {
                    teams[p.team].push(p);
                }
            });

            // ê²°ê³¼ ì˜ì—­ ë Œë”ë§
            Object.values(teams).forEach((teamRoster, teamIndex) => {
                const teamName = `íŒ€ ${teamIndex + 1}`;
                const teamColorClass = teamColors[teamIndex % teamColors.length];
                
                // ëª¨ë°”ì¼ì—ì„œëŠ” í•­ìƒ 1ì—´, ë°ìŠ¤í¬í†±ì—ì„œëŠ” 2ì—´ë¡œ ë³´ì´ë„ë¡ í´ë˜ìŠ¤ ì¡°ì •
                const teamEl = document.createElement('div');
                teamEl.className = `bg-white p-6 rounded-xl shadow-lg border-t-8 ${teamColorClass.replace('bg-', 'border-')}`;
                
                teamEl.innerHTML = `
                    <h3 class="text-3xl font-extrabold text-gray-800 mb-6">${teamName} ëª…ë‹¨</h3>
                    <h4 class="text-xl font-bold mt-2 mb-3 border-b pb-1 text-gray-700">ë¡œìŠ¤í„° ëª©ë¡ (${teamRoster.length}ëª…)</h4>
                    <ul class="space-y-1">
                        ${teamRoster.map(p => {
                            const isDud = p.position === 'DUD';
                            const bgColor = isDud ? 'bg-gray-700' : teamColorClass; // Use dark gray for DUD
                            const positionText = getKoreanPositionName(p.position);
                            const listItemClass = isDud ? 'bg-red-100 border border-red-400' : 'bg-gray-50';

                            return `
                                <li class="p-2 ${listItemClass} rounded-md flex justify-between items-center">
                                    <span class="font-semibold text-gray-800">${p.name}</span>
                                    <span class="text-sm font-bold text-white px-2 py-0.5 rounded-full ${bgColor}">
                                        ${positionText} ${isDud ? 'ğŸ’¥' : ''}
                                    </span>
                                </li>
                            `;
                        }).join('')}
                    </ul>
                `;
                resultsContainer.appendChild(teamEl);
            });
            
            // ê²°ê³¼ê°€ ì—†ì„ ê²½ìš° ì´ˆê¸° ë©”ì‹œì§€ í‘œì‹œ
            if (currentTeamRosters.length === 0 && draftPool.length === 0) {
                resultsContainer.innerHTML = `<div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg"><p class="text-lg text-gray-500 text-center py-10">ì™¼ìª½ì—ì„œ í¬ì§€ì…˜ì„ ì„¤ì •í•˜ê³  ì¶”ì²¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´ë“œë¥¼ ìƒì„±í•˜ì„¸ìš”.</p></div>`;
            }
        };


        // --------------------------------------------------
        // ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        // --------------------------------------------------
        window.onload = () => {
            initializePositionSettings();
            renderControlPanel(); // ì´ˆê¸° í™”ë©´ ë Œë”ë§
        };

    </script>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">
    <header class="text-center mb-8 pt-4"> <!-- ëª¨ë°”ì¼ ìƒë‹¨ ì—¬ë°± ë³´ê°• -->
        <h1 class="responsive-title text-4xl font-extrabold text-gray-900 tracking-tight">â­ ëœë¤ íŒ€ & í¬ì§€ì…˜ ì¹´ë“œ ë½‘ê¸°(ì„ íƒí˜•)</h1>
        <p class="mt-2 text-md text-gray-600">**[ìƒˆ ê·œì¹™ ì ìš©]** 2íŒ€ ì´ìƒ: P1, P2 (3ì¥) / P3~P8 (2ì¥) / ë‚˜ë¨¸ì§€ (1ì¥) | 1íŒ€: P1 (3ì¥) / P2~P4 (2ì¥) / ë‚˜ë¨¸ì§€ (1ì¥)</p>
    </header>

    <!-- ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´, ë°ìŠ¤í¬í†±ì—ì„œëŠ” 3ì—´ -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">

        <!-- ì™¼ìª½ ì„¹ì…˜: ì„¤ì • ë° ì‹¤í–‰ (ëª¨ë°”ì¼ì—ì„œ ë¨¼ì € ë³´ì„) -->
        <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-2xl h-fit lg:sticky lg:top-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">1. í¬ì§€ì…˜ë³„ ì¸ì› ì„¤ì •</h2>
            
            <div id="position-settings-container" class="space-y-2 mb-4">
                <!-- í¬ì§€ì…˜ ì„¤ì • ì¸í’‹ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            
            <p class="text-lg font-semibold text-gray-800 border-t pt-3">íŒ€ë‹¹ ì´ ì¸ì›: <span id="total-players-needed" class="text-blue-600">12</span>ëª…</p>

            <h2 class="text-2xl font-bold text-gray-800 mt-6 mb-4 border-b pb-2">2. ì¹´ë“œ ìƒì„± ë° ì¶”ì²¨ ì‹¤í–‰</h2>
            
            <div class="space-y-3">
                <button onclick="window.startDraftOneTeam()" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md hover:shadow-lg">
                    1íŒ€ ì¶”ì²¨ ì¹´ë“œ ìƒì„± (ì´ <span id="total-players-needed-1" class="font-bold">12</span>ì¥)
                </button>
                <button onclick="window.startDraftTwoTeams()" class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition duration-300 shadow-md hover:shadow-lg">
                    2íŒ€ ì¶”ì²¨ ì¹´ë“œ ìƒì„± (ì´ <span id="total-players-needed-2" class="font-bold">24</span>ì¥)
                </button>
            </div>
        </section>

        <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜: ì¹´ë“œ ë½‘ê¸° ë° ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ (ëª¨ë°”ì¼ì—ì„œ ì„¤ì • ë‹¤ìŒìœ¼ë¡œ ë³´ì„) -->
        <section class="lg:col-span-2 space-y-8">
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-2">3. ì¹´ë“œ ë½‘ê¸° ì˜ì—­</h2>
            <p id="draw-status-message" class="text-lg text-gray-600">ì™¼ìª½ì—ì„œ 'ì¹´ë“œ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ì²¨ì„ ì¤€ë¹„í•˜ì„¸ìš”.</p>
            
            <!-- ì¹´ë“œ ì˜ì—­ -->
            <div id="card-picker" class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4 min-h-[150px] items-start">
                <!-- ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ê²°ê³¼ ëª…ë‹¨ ì˜ì—­ -->
            <h2 class="text-2xl font-bold text-gray-800 border-b pb-2 mt-8">4. ì¶”ì²¨ ê²°ê³¼ ëª…ë‹¨</h2>
            <!-- ë°ìŠ¤í¬í†±ì—ì„œëŠ” 2ì—´, ëª¨ë°”ì¼ì—ì„œëŠ” 1ì—´ë¡œ ìë™ ì „í™˜ -->
            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- ì¶”ì²¨ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
            </div>
        </section>

    </main>

    <!-- ì»¤ìŠ¤í…€ ëª¨ë‹¬ (ê²½ê³ /ì˜¤ë¥˜ ë©”ì‹œì§€) -->
    <div id="custom-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 class="text-xl font-bold text-red-600 mb-4">ì„ íƒ ê²°ê³¼</h3>
            <p id="modal-message" class="text-gray-700 mb-4"></p>
            <button onclick="window.closeModal()" class="w-full bg-red-600 text-white font-semibold py-2 rounded-lg hover:bg-red-700 transition duration-300">
                ë‹¤ìŒ ì¶”ì²¨ ì§„í–‰
            </button>
        </div>
    </div>
</body>
</html>
